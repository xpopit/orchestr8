<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Orchestr8 MCP Dashboard</title>
        <link rel="stylesheet" href="style.css" />
        <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/marked@9.1.5/marked.min.js"></script>
    </head>
    <body>
        <!-- Header -->
        <header class="dashboard-header">
            <div class="header-left">
                <h1 class="logo">
                    <span class="logo-icon">‚ö°</span>
                    Orchestr8 MCP
                </h1>
                <span class="version">v2.0.0</span>
            </div>
            <div class="header-center">
                <div class="connection-status" id="connectionStatus">
                    <span class="status-dot"></span>
                    <span class="status-text">Connecting...</span>
                </div>
            </div>
            <div class="header-right">
                <button
                    class="btn btn-sm"
                    id="commandPaletteHint"
                    style="opacity: 0.7; font-size: 0.8rem"
                >
                    Press
                    <kbd
                        style="
                            padding: 0.125rem 0.375rem;
                            background: var(--bg-tertiary);
                            border-radius: 3px;
                            font-family: monospace;
                        "
                        >‚åòK</kbd
                    >
                    to search
                </button>
                <button
                    class="btn btn-icon"
                    id="refreshBtn"
                    title="Refresh Data"
                >
                    <span>‚Üª</span>
                </button>
                <button
                    class="btn btn-icon"
                    id="clearLogsBtn"
                    title="Clear Activity Log"
                >
                    <span>üóëÔ∏è</span>
                </button>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="dashboard-nav">
            <button class="nav-btn active" data-view="overview">
                <span class="nav-icon">üìä</span>
                <span class="nav-label">Overview</span>
            </button>
            <button class="nav-btn" data-view="testing">
                <span class="nav-icon">üß™</span>
                <span class="nav-label">Testing</span>
            </button>
            <button class="nav-btn" data-view="explorer">
                <span class="nav-icon">üóÇÔ∏è</span>
                <span class="nav-label">Resources</span>
            </button>
            <button class="nav-btn" data-view="activity">
                <span class="nav-icon">üì°</span>
                <span class="nav-label">Activity</span>
            </button>
            <button class="nav-btn" data-view="providers">
                <span class="nav-icon">üîå</span>
                <span class="nav-label">Providers</span>
            </button>
        </nav>

        <!-- Main Content -->
        <main class="dashboard-main">
            <!-- Overview View -->
            <div class="view active" id="overviewView">
                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-icon">üöÄ</span>
                            <span class="stat-label">Uptime</span>
                        </div>
                        <div class="stat-value" id="uptimeValue">--</div>
                        <div class="stat-footer">Server running</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-icon">üì®</span>
                            <span class="stat-label">Requests</span>
                        </div>
                        <div class="stat-value" id="requestsValue">0</div>
                        <div class="stat-footer">Total processed</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-icon">‚ö°</span>
                            <span class="stat-label">Avg Latency</span>
                        </div>
                        <div class="stat-value" id="latencyValue">--</div>
                        <div class="stat-footer">
                            <span>p95: <span id="p95Value">--</span></span>
                            <span>p99: <span id="p99Value">--</span></span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-icon">‚ùå</span>
                            <span class="stat-label">Errors</span>
                        </div>
                        <div class="stat-value" id="errorsValue">0</div>
                        <div class="stat-footer">Error count</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-icon">üíæ</span>
                            <span class="stat-label">Memory</span>
                        </div>
                        <div class="stat-value" id="memoryValue">--</div>
                        <div class="stat-footer">Heap usage</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-icon">üì¶</span>
                            <span class="stat-label">Resources</span>
                        </div>
                        <div class="stat-value" id="resourcesValue">--</div>
                        <div class="stat-footer">Total available</div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="charts-grid">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>Request Latency Distribution</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="latencyChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>Resource Usage by Category</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="resourceChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Token Efficiency Section -->
                <div class="token-efficiency-section" style="margin-top: 2rem;">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>üí∞ Token Efficiency Monitoring</h3>
                            <div style="display: flex; gap: 0.5rem; align-items: center;">
                                <select id="tokenPeriodSelect" class="form-control" style="width: auto; padding: 0.25rem 0.5rem; font-size: 0.875rem;">
                                    <option value="last_hour">Last Hour</option>
                                    <option value="last_day">Last Day</option>
                                    <option value="last_week">Last Week</option>
                                    <option value="all_time">All Time</option>
                                </select>
                                <button class="btn btn-sm" id="refreshTokenMetrics" title="Refresh Token Metrics">
                                    ‚Üª
                                </button>
                            </div>
                        </div>

                        <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); margin-bottom: 1.5rem;">
                            <div class="stat-card" style="background: linear-gradient(135deg, var(--accent-primary) 0%, #667eea 100%); color: white;">
                                <div class="stat-header">
                                    <span class="stat-icon">üìà</span>
                                    <span class="stat-label">Efficiency</span>
                                </div>
                                <div class="stat-value" id="tokenEfficiency">--</div>
                                <div class="stat-footer" style="color: rgba(255,255,255,0.9);">
                                    <span id="tokenEfficiencyTrend">--</span>
                                </div>
                            </div>

                            <div class="stat-card" style="background: linear-gradient(135deg, var(--accent-success) 0%, #06b6d4 100%); color: white;">
                                <div class="stat-header">
                                    <span class="stat-icon">üéØ</span>
                                    <span class="stat-label">Tokens Saved</span>
                                </div>
                                <div class="stat-value" id="tokensSaved">--</div>
                                <div class="stat-footer" style="color: rgba(255,255,255,0.9);">
                                    vs <span id="tokenBaseline">--</span> baseline
                                </div>
                            </div>

                            <div class="stat-card" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white;">
                                <div class="stat-header">
                                    <span class="stat-icon">üíµ</span>
                                    <span class="stat-label">Cost Saved</span>
                                </div>
                                <div class="stat-value" id="costSaved">--</div>
                                <div class="stat-footer" style="color: rgba(255,255,255,0.9);">
                                    Actual: <span id="actualCost">--</span>
                                </div>
                            </div>

                            <div class="stat-card" style="background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%); color: white;">
                                <div class="stat-header">
                                    <span class="stat-icon">üìä</span>
                                    <span class="stat-label">Cache Hit Rate</span>
                                </div>
                                <div class="stat-value" id="cacheHitRate">--</div>
                                <div class="stat-footer" style="color: rgba(255,255,255,0.9);">
                                    <span id="cacheHits">--</span> hits
                                </div>
                            </div>
                        </div>

                        <div class="charts-grid">
                            <div class="chart-container" style="height: 250px;">
                                <h4 style="font-size: 0.875rem; margin-bottom: 0.75rem; color: var(--text-secondary);">Category Efficiency</h4>
                                <canvas id="categoryEfficiencyChart"></canvas>
                            </div>

                            <div style="padding: 1rem; background: var(--bg-secondary); border-radius: var(--radius-md);">
                                <h4 style="font-size: 0.875rem; margin-bottom: 0.75rem; color: var(--text-secondary);">Top Performers</h4>
                                <div id="topPerformersList" style="max-height: 200px; overflow-y: auto;">
                                    <div class="activity-empty" style="font-size: 0.875rem;">Loading...</div>
                                </div>
                            </div>
                        </div>

                        <div style="margin-top: 1rem; padding: 0.75rem; background: var(--bg-secondary); border-radius: var(--radius-md); border-left: 3px solid var(--accent-primary);">
                            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 0.5rem;">
                                <div style="font-size: 0.875rem; color: var(--text-secondary);">
                                    üìö <strong>Learn more:</strong>
                                    <a href="/plugins/orchestr8/docs/token-efficiency-monitoring.md" target="_blank" style="color: var(--accent-primary); text-decoration: none;">Feature Guide</a> ‚Ä¢
                                    <a href="/plugins/orchestr8/docs/api/token-endpoints.md" target="_blank" style="color: var(--accent-primary); text-decoration: none;">API Reference</a>
                                </div>
                                <div style="font-size: 0.75rem; color: var(--text-tertiary);">
                                    Last updated: <span id="tokenMetricsTimestamp">--</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="activity-card">
                    <div class="activity-header">
                        <h3>Recent Activity</h3>
                        <button class="btn btn-sm" id="viewAllActivityBtn">
                            View All
                        </button>
                    </div>
                    <div class="activity-list" id="recentActivityList">
                        <div class="activity-empty">No activity yet</div>
                    </div>
                </div>
            </div>

            <!-- Testing View -->
            <div class="view" id="testingView">
                <div class="testing-layout">
                    <!-- Testing Panel -->
                    <div class="testing-panel">
                        <h2>Interactive Testing</h2>

                        <!-- Request Type Selector -->
                        <div class="form-group">
                            <label>Request Type</label>
                            <select id="requestType" class="form-control">
                                <option value="prompts/list">
                                    List Prompts
                                </option>
                                <option value="prompts/get">Get Prompt</option>
                                <option value="resources/list">
                                    List Resources
                                </option>
                                <option value="resources/read">
                                    Read Resource
                                </option>
                            </select>
                        </div>

                        <!-- Dynamic Form Fields -->
                        <div id="dynamicFormFields"></div>

                        <!-- Quick Examples -->
                        <div class="form-group">
                            <label>Quick Examples</label>
                            <div class="quick-examples">
                                <button
                                    class="btn btn-sm example-btn"
                                    data-example="list-prompts"
                                >
                                    List Prompts
                                </button>
                                <button
                                    class="btn btn-sm example-btn"
                                    data-example="list-resources"
                                >
                                    List Resources
                                </button>
                                <button
                                    class="btn btn-sm example-btn"
                                    data-example="registry-catalog"
                                >
                                    Registry Catalog
                                </button>
                                <button
                                    class="btn btn-sm example-btn"
                                    data-example="typescript-agent"
                                >
                                    TypeScript Agent
                                </button>
                                <button
                                    class="btn btn-sm example-btn"
                                    data-example="match-api"
                                >
                                    Match: API Skills
                                </button>
                                <button
                                    class="btn btn-sm example-btn"
                                    data-example="match-fullstack"
                                >
                                    Match: Full Stack
                                </button>
                                <button
                                    class="btn btn-sm example-btn"
                                    data-example="match-minimal"
                                >
                                    Match: Minimal Mode
                                </button>
                            </div>
                        </div>

                        <!-- Mode Information -->
                        <div class="form-group">
                            <div
                                style="
                                    display: flex;
                                    gap: 0.5rem;
                                    flex-wrap: wrap;
                                    font-size: 0.75rem;
                                "
                            >
                                <span
                                    style="
                                        padding: 0.25rem 0.5rem;
                                        background: var(--bg-tertiary);
                                        border-radius: var(--radius-sm);
                                        color: var(--text-secondary);
                                    "
                                >
                                    Default: Index Mode
                                </span>
                                <span
                                    style="
                                        padding: 0.25rem 0.5rem;
                                        background: var(--accent-success);
                                        border-radius: var(--radius-sm);
                                        color: white;
                                        font-weight: 600;
                                    "
                                >
                                    95-98% Token Reduction
                                </span>
                            </div>
                        </div>

                        <!-- Execute Button -->
                        <button
                            class="btn btn-primary btn-block"
                            id="executeTestBtn"
                        >
                            Execute Test
                        </button>
                    </div>

                    <!-- Results Panel -->
                    <div class="results-panel">
                        <div class="results-header">
                            <h3>Test Results</h3>
                            <div class="results-tabs">
                                <button
                                    class="tab-btn active"
                                    data-tab="content"
                                >
                                    Content
                                </button>
                                <button class="tab-btn" data-tab="protocol">
                                    Protocol
                                </button>
                                <button class="tab-btn" data-tab="metadata">
                                    Metadata
                                </button>
                            </div>
                        </div>

                        <div class="results-body">
                            <div class="tab-content active" id="contentTab">
                                <div class="results-empty">
                                    Execute a test to see results
                                </div>
                            </div>
                            <div class="tab-content" id="protocolTab">
                                <pre class="code-block"></pre>
                            </div>
                            <div class="tab-content" id="metadataTab">
                                <pre class="code-block"></pre>
                            </div>
                        </div>

                        <div class="results-footer">
                            <span
                                class="results-stats"
                                id="resultsStats"
                            ></span>
                            <button class="btn btn-sm" id="copyResultsBtn">
                                Copy
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Resources Explorer View -->
            <div class="view" id="explorerView">
                <div class="explorer-layout">
                    <!-- Sidebar -->
                    <div class="explorer-sidebar">
                        <div class="search-box">
                            <input
                                type="text"
                                id="resourceSearch"
                                placeholder="Search resources..."
                                class="form-control"
                            />
                        </div>

                        <div class="category-filters">
                            <h3>Categories</h3>
                            <div id="categoryList" class="category-list">
                                <div class="loading">Loading categories...</div>
                            </div>
                        </div>
                    </div>

                    <!-- Resource Grid -->
                    <div class="explorer-content">
                        <div class="explorer-header">
                            <h2>Resource Explorer</h2>
                            <div class="view-controls">
                                <button
                                    class="btn btn-icon active"
                                    data-view-type="grid"
                                    title="Grid View"
                                >
                                    <span>‚äû</span>
                                </button>
                                <button
                                    class="btn btn-icon"
                                    data-view-type="list"
                                    title="List View"
                                >
                                    <span>‚ò∞</span>
                                </button>
                            </div>
                        </div>

                        <div id="resourceGrid" class="resource-grid">
                            <div class="loading">Loading resources...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Activity Log View -->
            <div class="view" id="activityView">
                <div class="activity-layout">
                    <div class="activity-controls">
                        <h2>Live Activity Feed</h2>
                        <div class="activity-filters">
                            <button
                                class="btn btn-sm filter-btn active"
                                data-filter="all"
                            >
                                All
                            </button>
                            <button
                                class="btn btn-sm filter-btn"
                                data-filter="mcp_request"
                            >
                                Requests
                            </button>
                            <button
                                class="btn btn-sm filter-btn"
                                data-filter="mcp_response"
                            >
                                Responses
                            </button>
                            <button
                                class="btn btn-sm filter-btn"
                                data-filter="error"
                            >
                                Errors
                            </button>
                            <button
                                class="btn btn-sm filter-btn"
                                data-filter="log"
                            >
                                Logs
                            </button>
                        </div>
                        <button class="btn btn-sm" id="pauseActivityBtn">
                            Pause
                        </button>
                    </div>

                    <div class="activity-feed" id="activityFeed">
                        <div class="activity-empty">
                            Waiting for activity...
                        </div>
                    </div>
                </div>
            </div>

            <!-- Providers View -->
            <div class="view" id="providersView">
                <div class="providers-layout">
                    <!-- Provider Status Section -->
                    <div class="providers-header">
                        <h2>Resource Providers</h2>
                        <button class="btn btn-sm" id="refreshProvidersBtn">
                            ‚Üª Refresh
                        </button>
                    </div>

                    <!-- Provider Cards -->
                    <div class="providers-grid" id="providersGrid">
                        <div class="loading">Loading providers...</div>
                    </div>

                    <!-- Provider Testing Section -->
                    <div class="provider-testing-section">
                        <h3>Test Provider Search</h3>

                        <div class="testing-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Provider</label>
                                    <select
                                        id="providerTestSelect"
                                        class="form-control"
                                    >
                                        <option value="all">
                                            All Providers
                                        </option>
                                        <option value="local">Local</option>
                                        <option value="aitmpl">AITMPL</option>
                                        <option value="github">GitHub</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label>Search Query</label>
                                    <input
                                        type="text"
                                        id="providerSearchQuery"
                                        class="form-control"
                                        placeholder="e.g., typescript api development"
                                    />
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Categories (comma-separated)</label>
                                    <input
                                        type="text"
                                        id="providerSearchCategories"
                                        class="form-control"
                                        placeholder="e.g., agent,skill,example"
                                    />
                                </div>

                                <div class="form-group">
                                    <label>Max Results</label>
                                    <input
                                        type="number"
                                        id="providerSearchMaxResults"
                                        class="form-control"
                                        value="10"
                                        min="1"
                                        max="100"
                                    />
                                </div>

                                <div class="form-group">
                                    <label>Min Score</label>
                                    <input
                                        type="number"
                                        id="providerSearchMinScore"
                                        class="form-control"
                                        value="15"
                                        min="0"
                                        max="100"
                                    />
                                </div>
                            </div>

                            <button
                                class="btn btn-primary"
                                id="executeProviderSearchBtn"
                            >
                                üîç Search Providers
                            </button>
                        </div>

                        <!-- Provider Search Results -->
                        <div
                            class="provider-results"
                            id="providerResults"
                            style="display: none"
                        >
                            <div class="results-header">
                                <h4>Search Results</h4>
                                <div
                                    class="results-info"
                                    id="providerResultsInfo"
                                ></div>
                            </div>
                            <div
                                class="provider-results-content"
                                id="providerResultsContent"
                            ></div>
                        </div>
                    </div>

                    <!-- Provider Health Modal -->
                    <div id="providerHealthModal" class="modal">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h3 id="modalProviderName"></h3>
                                <button class="modal-close">&times;</button>
                            </div>
                            <div class="modal-body" id="modalProviderContent">
                                <div class="loading">Loading...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Resource Detail Modal (Shared across views) -->
        <div id="resourceModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalResourceName"></h3>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body" id="modalResourceContent">
                    <div class="loading">Loading...</div>
                </div>
            </div>
        </div>

        <!-- Activity Detail Modal -->
        <div id="activityDetailModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalActivityTitle"></h3>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body" id="modalActivityContent">
                    <div class="activity-detail-tabs">
                        <button class="tab-btn active" data-tab="summary">
                            Summary
                        </button>
                        <button class="tab-btn" data-tab="request">
                            Request
                        </button>
                        <button class="tab-btn" data-tab="response">
                            Response
                        </button>
                        <button class="tab-btn" data-tab="raw">Raw JSON</button>
                    </div>
                    <div class="activity-detail-body">
                        <div
                            class="tab-content active"
                            id="activitySummaryTab"
                        ></div>
                        <div class="tab-content" id="activityRequestTab">
                            <pre class="code-block"></pre>
                        </div>
                        <div class="tab-content" id="activityResponseTab">
                            <pre class="code-block"></pre>
                        </div>
                        <div class="tab-content" id="activityRawTab">
                            <pre class="code-block"></pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Toast Notifications -->
        <div id="toastContainer" class="toast-container"></div>

        <script src="app.js"></script>
        <script src="command-palette.js"></script>
        <script src="resource-preview.js"></script>
        <script src="activity-timeline.js"></script>
    </body>
</html>
